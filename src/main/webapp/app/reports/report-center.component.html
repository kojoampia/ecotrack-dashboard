<div class="report-center">
  <h2>Report Center - One-Click Audit</h2>

  <!-- Audit Trail Status Overview -->
  <div class="status-overview">
    <mat-card class="status-card">
      <mat-card-header>
        <mat-card-title>Audit Trail Status</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-grid">
          <div class="status-item">
            <div class="status-number">{{ auditTrailStatus.totalReports }}</div>
            <div class="status-label">Total Reports</div>
          </div>
          <div class="status-item">
            <div class="status-number generated">{{ auditTrailStatus.generatedReports }}</div>
            <div class="status-label">Generated</div>
          </div>
          <div class="status-item">
            <div class="status-number pending">{{ auditTrailStatus.pendingReports }}</div>
            <div class="status-label">Pending</div>
          </div>
          <div class="status-item">
            <div class="status-number error">{{ auditTrailStatus.errorReports }}</div>
            <div class="status-label">Errors</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Reports Table -->
  <mat-card class="reports-card">
    <mat-card-header>
      <mat-card-title>Compliance Reports</mat-card-title>
      <mat-card-subtitle>CBAM Audit-Ready Evidence Packets</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="loading" class="loading-spinner">
        <mat-spinner></mat-spinner>
      </div>

      <table mat-table [dataSource]="reports" class="reports-table" *ngIf="!loading">
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let report">{{ report.id }}</td>
        </ng-container>

        <!-- Period Column -->
        <ng-container matColumnDef="period">
          <th mat-header-cell *matHeaderCellDef>Reporting Period</th>
          <td mat-cell *matCellDef="let report">
            {{ report.reportPeriodStart | date: 'shortDate' }} - {{ report.reportPeriodEnd | date: 'shortDate' }}
          </td>
        </ng-container>

        <!-- Emissions Column -->
        <ng-container matColumnDef="emissions">
          <th mat-header-cell *matHeaderCellDef>Total Emissions (kg CO2e)</th>
          <td mat-cell *matCellDef="let report">{{ report.totalEmissions | number: '1.0-0' }}</td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let report">
            <mat-chip [color]="getStatusColor(report.status)" selected>
              {{ report.status }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let report">
            <button mat-icon-button [matTooltip]="'Download Audit Report'" (click)="downloadAuditReport(report.id)">
              <mat-icon>picture_as_pdf</mat-icon>
            </button>
            <button
              mat-icon-button
              [matTooltip]="'Download CBAM XML'"
              (click)="downloadCBAMPayload(report.id)"
              *ngIf="report.payloadGenerated"
            >
              <mat-icon>download</mat-icon>
            </button>
            <button mat-icon-button [matTooltip]="'Generate Payload'" (click)="generateReport(report.id)" *ngIf="!report.payloadGenerated">
              <mat-icon>play_arrow</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <div *ngIf="reports.length === 0 && !loading" class="no-reports">
        <mat-icon>description</mat-icon>
        <p>No compliance reports found. Generate your first CBAM report to get started.</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- CBAM Export Info -->
  <mat-card class="info-card">
    <mat-card-header>
      <mat-card-title>CBAM 2026 Compliance</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p><strong>Annual Declaration Deadline:</strong> May 31st</p>
      <p><strong>Required Format:</strong> TARIC/CBAM Portal XML</p>
      <p><strong>Evidence Packet:</strong> PDF Report + XML Payload</p>
      <p><strong>Confidence Score:</strong> Based on data completeness and source verification</p>
    </mat-card-content>
  </mat-card>
</div>
